<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AM4 day3 ë‹¨ì–´ì¥ í€´ì¦ˆ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    h1, h2 { text-align: center; }
    #controls { display: flex; gap: 10px; justify-content: center; align-items: center; margin-bottom: 20px; flex-wrap: wrap; }
    button { padding: 12px 24px; margin: 4px; cursor: pointer; border: none; border-radius: 4px; font-size: 16px; }
    #scoreboard { font-weight: bold; margin-left: 20px; }
    #checklist { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; min-height: 50px; }
    #checklist .item { padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; width: 300px; text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    input[type="text"] { width: calc(100% - 16px); padding: 8px; margin-bottom: 6px; box-sizing: border-box; font-size: 16px; }
    .feedback { min-height: 22px; color: #dc3545; font-size: 14px; margin-bottom: 8px; }
    .btn-start { background: #007bff; color: white; }
    .btn-submit { background: #28a745; color: white; }
    .btn-stop { background: #dc3545; color: white; }
    .btn-retry { background: #ffc107; color: #212529; }
    .btn-restart { background: #17a2b8; color: white; }
    .btn-shuffle { background: #6c757d; color: white; }
    .btn-skip { background: #6c757d; color: white; }

    /* í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.3s ease; }
  </style>
</head>
<body>
  <h1>AM4 day3 ë‹¨ì–´ì¥ í€´ì¦ˆ</h1>
  <div id="controls"></div>
  <div id="checklist"></div>
  <div id="app"></div>

  <script>
    const originalList = [
      { korean: "ì‘ê¸‰ ìƒí™© ëŒ€ë¹„ ì ˆì°¨", english: "Emergency Procedures" },
      { korean: "ëŒ€ë¹„ì±…", english: "Before an Emergency" },
      { korean: "ì‘ê¸‰ ìƒí™©ì— ëŒ€ë¹„í•œ ê³„íšì„ ì„¸ìš´ë‹¤", english: "plan for an emergency" },
      { korean: "ë§Œë‚  ì¥ì†Œ", english: "a meeting place" },
      { korean: "íƒ€ì£¼ ì—°ë½ì±…", english: "an out-of-state contact" },
      { korean: "íƒˆì¶œ ê²½ë¡œ", english: "an escape route" },
      { korean: "ê°€ìŠ¤ ì ê¸ˆ ë°¸ë¸Œ", english: "a gas shut-off valve" },
      { korean: "í”¼ë‚œ ê²½ë¡œ", english: "an evacuation route" },
      { korean: "ì¬í•´ ëŒ€ì±… í‚¤íŠ¸ë¥¼ ë§Œë“ ë‹¤", english: "Make a disaster kit" },
      { korean: "ë”°ëœ»í•œ ì˜·", english: "warm clothes" },
      { korean: "ë‹´ìš”", english: "blankets" },
      { korean: "ê¹¡í†µ ë”°ê°œ", english: "a can opener" },
      { korean: "ìº” ì‹í’ˆ", english: "canned food" },
      { korean: "í¬ì¥ëœ ì‹í’ˆ", english: "packaged food" },
      { korean: "ìƒìˆ˜", english: "bottled water" },
      { korean: "ë¬¼í‹°ìŠˆ", english: "moist towelettes" },
      { korean: "í™”ì¥ì§€", english: "toilet paper" },
      { korean: "ì†ì „ë“±", english: "a flashlight" },
      { korean: "ê±´ì „ì§€", english: "batteries" },
      { korean: "ì„±ëƒ¥", english: "matches" },
      { korean: "í˜„ê¸ˆê³¼ ë™ì „", english: "cash and coins" },
      { korean: "ì‘ê¸‰ ì¹˜ë£Œ ìƒì", english: "a first aid kit" },
      { korean: "ì‹ ë¶„ì¦ê³¼ ì‹ ìš© ì¹´ë“œ ì‚¬ë³¸", english: "copies of ID and credit cards" },
      { korean: "ì£¼ìš” ì„œë¥˜ ì‚¬ë³¸", english: "copies of important papers" },
      { korean: "ì‘ê¸‰ ìƒí™©ì¤‘ì—", english: "During an Emergency" },
      { korean: "ë‚ ì”¨ë¥¼ ì§€ì¼œë³¸ë‹¤", english: "Watch the weather" },
      { korean: "ê²½ê³ ì— ì£¼ì˜ë¥¼ ê¸°ìš¸ì¸ë‹¤", english: "Pay attention to warnings" },
      { korean: "ì¹¨ì°©í•¨ì„ ìœ ì§€í•œë‹¤", english: "Remain calm" },
      { korean: "ì§€ì‹œë¥¼ ë”°ë¥¸ë‹¤", english: "Follow directions" },
      { korean: "ì¥ì• ì¸ì„ ë„ì™€ì¤€ë‹¤", english: "Help people with disabilities" },
      { korean: "ë³´í˜¸ì†Œë¥¼ ì°¾ëŠ”ë‹¤", english: "Seek shelter" },
      { korean: "ì°½ë¬¸ì—ì„œ ë–¨ì–´ì ¸ ìˆëŠ”ë‹¤", english: "Stay away from windows" },
      { korean: "ëª¸ì„ ìˆ¨ê¸´ë‹¤", english: "Take cover" },
      { korean: "í•´ë‹¹ ì§€ì—­ì„ ë¹ ì ¸ ë‚˜ê°„ë‹¤", english: "Evacuate the area" },
      { korean: "ì‘ê¸‰ ìƒí™© ì¢…ë£Œ í›„", english: "After an Emergency" },
      { korean: "íƒ€ì£¼ ì—°ë½ì±…ì— ì „í™”í•œë‹¤", english: "Call out-of-state contacts" },
      { korean: "ì”í•´ë¥¼ ì²­ì†Œí•œë‹¤", english: "Clean up debris" },
      { korean: "ê°€ì • ë‚´ ê°€ìŠ¤, ë³´ì¼ëŸ¬, ìˆ˜ë„ ë“±ì„ ì ê²€í•œë‹¤", english: "Inspect utilities" },
      { korean: "ì¤‘ê³ í’ˆ ê°€ê²Œ", english: "a thrift store" },
      { korean: "s/tì„ í™˜ê¸°ì‹œí‚¤ë‹¤", english: "air s/t out" },
      { korean: "ì˜ëª» ì•Œê³  ìˆë‹¤", english: "have it wrong" },
      { korean: "ì‚¬ë‘í•˜ëŠ”, ì†Œì¤‘í•œ", english: "dear" },
      { korean: "ì´ê²ƒì €ê²ƒ, ì¡°ê¸ˆ", english: "bits and pieces" },
      { korean: "s/oí•œí…Œ ìˆ ì„ ë¨¹ì´ë‹¤", english: "get s/o drunk" },
      { korean: "ì¼ì— ë¹ íŠ¸ë¦¬ë‹¤", english: "throw oneself into work" },
      { korean: "ë¨¸ë¦¬ë¥¼ ê¸°ë¥´ë‹¤", english: "grow out one's hair" },
      { korean: "s/tì„ ì‘ì„±í•˜ë‹¤, ì±„ìš°ë‹¤ (ì •ë³´ë¥¼)", english: "fill s/t in" },
      { korean: "ìë‹¤", english: "crash" },
      { korean: "ì–´ì©” ìˆ˜ ì—†ì–´", english: "I can't help it" },
      { korean: "ê·¸ëŸ¬ë©´ ì•ˆ ë˜ëŠ” ê±°ì•¼", english: "That's just wrong" }
    ];
        
    let baseList = [...originalList];
    let quizList = [...baseList];
    let history = [];
    let correctCount = 0, wrongCount = 0;
    let stage = 'initial';
    let shuffleEnabled = false;

    function normalize(str) {
      return str.replace(/[^a-z]/gi, '').toLowerCase();
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function toggleShuffle() {
      shuffleEnabled = !shuffleEnabled;
      rebuildQuizList();
      render();
    }

    function rebuildQuizList() {
      const done = history.map(h => ({ korean: h.korean, english: h.english }));
      const doneSet = new Set(done.map(d => d.korean));
      let remaining = baseList.filter(item => !doneSet.has(item.korean));
      if (shuffleEnabled) remaining = shuffleArray([...remaining]);
      quizList = [...done, ...remaining];
    }

    function renderControls() {
      const ctrl = document.getElementById('controls');
      ctrl.innerHTML = '';
      if (stage === 'initial') {
        const shuffleBtn = document.createElement('button');
        shuffleBtn.textContent = shuffleEnabled ? 'Shuffle: ON' : 'Shuffle: OFF';
        shuffleBtn.className = 'btn-shuffle';
        shuffleBtn.onclick = toggleShuffle;
        ctrl.appendChild(shuffleBtn);
        const startBtn = document.createElement('button');
        startBtn.textContent = 'Start Quiz';
        startBtn.className = 'btn-start';
        startBtn.onclick = () => { stage = 'quiz'; rebuildQuizList(); render(); };
        ctrl.appendChild(startBtn);
      }
      if (stage === 'quiz') {
        const stopBtn = document.createElement('button');
        stopBtn.textContent = 'Stop Quiz'; stopBtn.className = 'btn-stop'; stopBtn.onclick = () => { stage = 'initial'; render(); };
        ctrl.appendChild(stopBtn);
        const shuffleBtn = document.createElement('button');
        shuffleBtn.textContent = shuffleEnabled ? 'Shuffle: ON' : 'Shuffle: OFF';
        shuffleBtn.className = 'btn-shuffle'; shuffleBtn.onclick = toggleShuffle;
        ctrl.appendChild(shuffleBtn);
      }
      if (stage === 'results') {
        const retryBtn = document.createElement('button');
        retryBtn.textContent = 'Retry Wrong Words'; retryBtn.className = 'btn-retry'; retryBtn.onclick = retryWrong;
        ctrl.appendChild(retryBtn);
        const restartBtn = document.createElement('button');
        restartBtn.textContent = 'Restart Full Quiz'; restartBtn.className = 'btn-restart'; restartBtn.onclick = restart;
        ctrl.appendChild(restartBtn);
      }
      const score = document.createElement('span');
      score.id = 'scoreboard'; score.textContent = `ë§ìŒ: ${correctCount}, í‹€ë¦¼: ${wrongCount}`;
      ctrl.appendChild(score);
    }

    function renderChecklist() {
      const cl = document.getElementById('checklist');
      cl.innerHTML = '';
      if (stage === 'quiz') {
        const div = document.createElement('div'); div.className = 'item';
        if (history.length > 0) {
          const item = history[history.length - 1];
          div.innerHTML = item.isCorrect
            ? `${item.korean}: âœ… ${item.english}`
            : `${item.korean}: âŒ ì •ë‹µ: ${item.english}<br>(ë‚´ ë‹µ: ${item.userAnswer})`;
        }
        cl.appendChild(div);
      }
    }

    function render() {
      renderControls(); renderChecklist();
      const app = document.getElementById('app'); app.innerHTML = '';
      if (stage === 'initial') {
        app.innerHTML = `<table><thead><tr><th>í•œêµ­ì–´</th><th>English</th></tr></thead>` +
                        `<tbody>${originalList.map(i => `<tr><td>${i.korean}</td><td>${i.english}</td></tr>`).join('')}</tbody></table>`;
      }
      if (stage === 'quiz') {
        const idx = history.length;
        const curr = quizList[idx];
        app.innerHTML = `<div><strong>Q${idx+1}.</strong> ${curr.korean}</div>` +
                        `<input type="text" id="answer" autofocus />` +
                        `<div id="feedback" class="feedback"></div>` +
                        `<button class="btn-submit">Submit</button>`+
                        `<button class="btn-skip">ëª¨ë¥´ê² ì–´ìš” (Skip)</button>`;
        const input = document.getElementById('answer');
        const feedback = document.getElementById('feedback');
        const submitBtn = app.querySelector('.btn-submit');
        const skipBtn = app.querySelector('.btn-skip');

        function focusInput(){ input.focus(); input.select && input.select(); }
        focusInput();

        submitBtn.onclick = submitAnswer;
        skipBtn.onclick = skipQuestion;
        input.onkeydown = e => { if (e.key === 'Enter') { e.preventDefault(); submitAnswer(); }};

        function submitAnswer(){
          const val = input.value.trim();
          if (!val) { feedback.textContent = 'ì…ë ¥ í›„ Enter ë˜ëŠ” Submitì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.'; focusInput(); return; }
          const isCorrect = normalize(val) === normalize(curr.english);
          if (!isCorrect) {
            feedback.textContent = 'ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
            input.classList.remove('shake');
            void input.offsetWidth; // reflow to retrigger
            input.classList.add('shake');
            focusInput();
            return; // ê¸°ë¡/ì±„ì í•˜ì§€ ì•ŠìŒ
          }
          // ì •ë‹µì¼ ë•Œë§Œ ê¸°ë¡
          history.push({ korean: curr.korean, english: curr.english, isCorrect: true, userAnswer: val });
          correctCount++;
          feedback.textContent = '';
          goNext();
        }

        function skipQuestion(){
          const val = input.value.trim();
          history.push({ korean: curr.korean, english: curr.english, isCorrect: false, userAnswer: val });
          wrongCount++;
          feedback.textContent = '';
          goNext();
        }

        function goNext(){
          if (history.length < quizList.length) {
            render();
          } else {
            stage = 'results';
            render();
          }
        }
      }
      if (stage === 'results') {
        let html = '<h2>Quiz Finished!</h2>';
        html += wrongCount > 0
          ? `<p>You got ${wrongCount} wrong:</p><table><thead><tr><th>í•œêµ­ì–´</th><th>English</th></tr></thead>` +
            `<tbody>${history.filter(h => !h.isCorrect).map(h => `<tr><td>${h.korean}</td><td>${h.english}</td></tr>`).join('')}</tbody></table>`
          : '<p>Perfect score! ğŸ‰</p>';
        document.getElementById('app').innerHTML = html;
      }
    }

    function retryWrong() {
      baseList = history.filter(h => !h.isCorrect).map(h => ({ korean: h.korean, english: h.english }));
      history = [];
      correctCount = 0; wrongCount = 0;
      stage = 'quiz'; shuffleEnabled = false; rebuildQuizList(); render();
    }

    function restart() {
      baseList = [...originalList]; quizList = [...baseList];
      history = []; correctCount = 0; wrongCount = 0;
      shuffleEnabled = false; stage = 'initial'; render();
    }

    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>
